{
  "posts": [
    {
      "id": 19,
      "title": "Your most unhappy customers are your greatest source of learning.",
      "public_date": "",
      "featured": true,
      "categories": [
        "business",
        "travel"
      ],
      "image": "https://res.cloudinary.com/do3hzrufo/image/upload/v1651253082/file-upload/tmp-21-1651253080611_y7w67s.webp",
      "description": "Far far away, behind the word mountains, far from the countries Vokalia and Consonantia, there live the blind texts. Separated they live in Bookmarksgrove right at the coast of the Semantics, a large language ocean",
      "content": "<p>Far far away, behind the word mountains, far from the countries Vokalia and Consonantia, there live the blind texts.</p><p><img src=\"https://preview.colorlib.com/theme/magdesign/images/ximg_2.jpg.pagespeed.ic.fbbBEgB1Q6.webp\" alt=\"Image\"></p><p>Far far away, behind the word mountains, far from the countries Vokalia and Consonantia, there live the blind texts. Separated they live in Bookmarksgrove right at the coast of the Semantics, a large language ocean.</p><p>A small river named Duden flows by their place and supplies it with the necessary regelialia. It is a paradisematic country, in which roasted parts of sentences fly into your mouth.</p><blockquote><p><i>The Big Oxmox advised her not to do so, because there were thousands of bad Commas, wild Question Marks and devious Semikoli, but the Little Blind Text didn’t listen. She packed her seven versalia, put her initial into the belt and made herself on the way.</i></p></blockquote><p>Even the all-powerful Pointing has no control about the blind texts it is an almost unorthographic life One day however a small line of blind text by the name of Lorem Ipsum decided to leave for the far World of Grammar.</p><p>When she reached the first hills of the Italic Mountains, she had a last view back on the skyline of her hometown Bookmarksgrove, the headline of Alphabet Village and the subline of her own road, the Line Lane. Pityful a rethoric question ran over her cheek, then she continued her way.</p><p>Far far away, behind the word mountains, far from the countries Vokalia and Consonantia, there live the blind texts. Separated they live in Bookmarksgrove right at the coast of the Semantics, a large language ocean.</p><p>A small river named Duden flows by their place and supplies it with the necessary regelialia. It is a paradisematic country, in which roasted parts of sentences fly into your mouth.</p>"
    },
    {
      "id": 18,
      "title": "China roundup: Keep down internet upstarts, cultivate hard tech",
      "public_date": "",
      "categories": [
        "business",
        "travel",
        "education"
      ],
      "image": "https://res.cloudinary.com/do3hzrufo/image/upload/v1651235386/file-upload/tmp-20-1651235384357_pzpune.webp",
      "description": "Hello and welcome back to TechCrunch’s China roundup, a digest of recent events shaping the Chinese tech landscape and what they mean to people in the rest of the world.",
      "content": "<p style=\"margin-left:0px;\">Hello and welcome back to <a href=\"https://techcrunch.com/tag/china-roundup/\">TechCrunch’s China roundup</a>, a digest of recent events shaping the Chinese tech landscape and what they mean to people in the rest of the world.</p><p style=\"margin-left:0px;\">The tech industry in China has had quite a turbulent week. The government is upending its $100 billion private education sector, wiping billions from the market cap of the industry’s most lucrative players. Meanwhile, the assault on Chinese internet giants continued. Tech stocks tumbled after <a href=\"https://techcrunch.com/2021/07/27/tencents-wechat-suspends-new-user-registration-in-china-to-comply-with-relevant-laws-and-regulations/\">Tencent suspended user registration</a>, sparking fears over who will be the next target of Beijing’s wrath.</p><p style=\"margin-left:0px;\">Incisive observers point out that the new wave of stringent regulations against China’s internet and education firms has long been on Beijing’s agenda and there’s nothing surprising. Indeed, the central government has been unabashed about its desires to <a href=\"https://twitter.com/ruima/status/1420109129847214084\">boost manufacturing</a> and contain the unchecked powers of its service industry, which can include everything from internet platforms, film studios to after-school centers.</p><p style=\"margin-left:0px;\"><span style=\"color:rgb(51,51,51);\">A </span>few weeks ago I had an informative conversation with a Chinese venture capitalist who has been investing in industrial robots for over a decade, so I’m including it in this issue as it provides useful context for what’s going on in the consumer tech industry this week.</p><h2 style=\"margin-left:0px;\"><strong>Automate the factories</strong></h2><p style=\"margin-left:0px;\">China is putting robots into factories at an aggressive pace. Huang He, a partner at Northern Light Venture Capital, sees three forces spurring the demand for industrial robots — particularly ones that are made in China.</p><p style=\"margin-left:0px;\">Over the years, Beijing has advocated for “localization” in a broad range of technology sectors, from enterprise software to production line automation. One may start to see Chinese robots that can rival those of Schneider and Panasonic a few years down the road. CRP, an NLVC-backed industrial robot maker, is already selling across Southeast Asia, Russia and East Europe.</p><p style=\"margin-left:0px;\">On top of tech localization, it’s also well acknowledged that China is facing a severe demographic crisis. The labor shortage in its manufacturing sector is further compounded by the reluctance of young people to do menial factory work. Factory robots could offer a hand.</p><p style=\"margin-left:0px;\">“Youngsters these days would rather become food delivery riders than work in a factory. The work that robots replace is the low-skilled type, and those that still can’t be taken up by robots pay well and come with great benefits,” Huang observed.</p><p style=\"margin-left:0px;\">Large corporations in China still lean toward imported robots due to the products’ proven stability. The problem is that imported robots are not only expensive but also selective about their users.</p><p style=\"margin-left:0px;\">“Companies need to have deep technical capabilities to be able to operate these [Western] robots, but such companies are rare in China,” said Huang, adding that the overwhelming majority of Chinese enterprises are small and medium size.</p><p style=\"margin-left:0px;\">With the exceptions of the automotive and semiconductor industries, which still largely rely on sophisticated, imported robots, affordable, easy-to-use Chinese robots can already meet most of the local demand for industrial automation, Huang said.</p><p style=\"margin-left:0px;\">China currently uses nearly one million six-axis robots a year but only manufactures 20% of them itself. The gap, coupled with a national plan for localization, has led to a frenzy of investments in industrial robotics startups.</p><p style=\"margin-left:0px;\">The rush isn’t necessarily a good thing, said Huang. “There’s this bizarre phenomenon in China, where the most funded and valuable industrial robotic firms are generating less than 30 million yuan in annual revenue and not really heard of by real users in the industry.”</p><p style=\"margin-left:0px;\">“This isn’t an industry where giants can be created by burning through cash. It’s not the internet sector.”</p><p style=\"margin-left:0px;\">Small-and-medium-size businesses are happily welcoming robots onto factory floors. Take welding for example. An average welder costs about 150,000 yuan ($23,200) a year. A typical welding robot, which is sold for 120,000 yuan, can replace up to three workers a year and “doesn’t complain at work,” said the investor. A quality robot can work continuously for six to eight years, so the financial incentive to automate is obvious.</p><p style=\"margin-left:0px;\">Advanced manufacturing is not just helping local bosses. It will eventually increase foreign enterprises’ dependence on China for its efficiency, making it hard to cut off Chinese supply chains despite efforts to avoid the geopolitical risks of manufacturing in China.</p><p style=\"margin-left:0px;\">“In electronics, for example, most of the supply chains are in China, so factories outside China end up spending more on logistics to move parts around. Much of the 3C manufacturing is already highly automated, which relies heavily on electricity, but in most emerging economies, the power supply is still quite unstable, which disrupts production,” said Huang.</p><h2 style=\"margin-left:0px;\"><strong>War on internet titans</strong></h2><p style=\"margin-left:0px;\">The shock of antitrust regulations against Alibaba from last year is still reverberating, but another wave of scrutiny has already begun. Shortly after Didi’s blockbuster IPO in New York, the ride-hailing giant was asked to <a href=\"https://techcrunch.com/2021/07/20/china-roundup-data-security-clampdown/\">cease user registration</a> and work on protecting user information critical to national security.</p><p style=\"margin-left:0px;\">On Tuesday, Tencent stocks <a href=\"https://www.reuters.com/technology/international-investor-concerns-mount-over-chinas-tech-rout-2021-07-27/\">fell the most in a decade</a> after it halted user signups on its WeChat messenger as it <a href=\"https://techcrunch.com/2021/07/27/tencents-wechat-suspends-new-user-registration-in-china-to-comply-with-relevant-laws-and-regulations/\">“upgrades” its security technology to align with relevant laws and regulations</a>. The gaming and social media giant is just the latest in a growing list of companies hit by Beijing’s tightening grip on the internet sector, which had been flourishing for two decades under laissez-faire policies.</p><p style=\"margin-left:0px;\">Underlying the clampdowns is Beijing’s growing unease with the service industry’s unscrutinized accumulation of wealth and power. China is unequivocally determined to advance its tech sector, but the types of tech that Beijing wants are not so much the video games that bring myopia to children and algorithms that get adults hooked to their screens. China makes it clear in its <a href=\"https://www.uscc.gov/sites/default/files/2021-04/April_2021_Trade_Bulletin.pdf\">five-year plan</a>, a series of social and economic initiatives, that it will go all-in on “hard tech” like semiconductors, renewable energy, agritech, biotech and industrial automation like factory robotics.</p><p style=\"margin-left:0px;\"><span style=\"color:rgb(51,51,51);\">China has also vowed to fight inequality in education and wealth. In the authorities’ eyes, expensive, for-profit after-schools dotting big cities are hindering education attainment for children from poorer areas, which eventually exacerbates the wealth gap. The new regulatory measures have restricted the</span><a href=\"https://techcrunch.com/2021/07/26/as-china-shakes-up-regulations-tech-companies-suffer/\"> hours, content, profits and financing of private tutoring institutions</a><span style=\"color:rgb(51,51,51);\">, tanking stocks of the industry’s top companies. Again, there have been clear indications from</span><a href=\"https://twitter.com/henrysgao/status/1420013465805094912\"> President Xi Jinping’s writings</a><span style=\"color:rgb(51,51,51);\"> to bring off-campus tutoring “back on the educational track.” All China-focused investors and analysts are now poring over Xi’s thoughts and directives.</span></p>"
    },
    {
      "id": 19,
      "title": "Your most unhappy customers are your greatest source of learning.",
      "public_date": "",
      "categories": [
        "business",
        "travel",
        "education"
      ],
      "image": "https://res.cloudinary.com/do3hzrufo/image/upload/v1651253082/file-upload/tmp-21-1651253080611_y7w67s.webp",
      "description": "Far far away, behind the word mountains, far from the countries Vokalia and Consonantia, there live the blind texts. Separated they live in Bookmarksgrove right at the coast of the Semantics, a large language ocean",
      "content": "<p>Far far away, behind the word mountains, far from the countries Vokalia and Consonantia, there live the blind texts.</p><p><img src=\"https://preview.colorlib.com/theme/magdesign/images/ximg_2.jpg.pagespeed.ic.fbbBEgB1Q6.webp\" alt=\"Image\"></p><p>Far far away, behind the word mountains, far from the countries Vokalia and Consonantia, there live the blind texts. Separated they live in Bookmarksgrove right at the coast of the Semantics, a large language ocean.</p><p>A small river named Duden flows by their place and supplies it with the necessary regelialia. It is a paradisematic country, in which roasted parts of sentences fly into your mouth.</p><blockquote><p><i>The Big Oxmox advised her not to do so, because there were thousands of bad Commas, wild Question Marks and devious Semikoli, but the Little Blind Text didn’t listen. She packed her seven versalia, put her initial into the belt and made herself on the way.</i></p></blockquote><p>Even the all-powerful Pointing has no control about the blind texts it is an almost unorthographic life One day however a small line of blind text by the name of Lorem Ipsum decided to leave for the far World of Grammar.</p><p>When she reached the first hills of the Italic Mountains, she had a last view back on the skyline of her hometown Bookmarksgrove, the headline of Alphabet Village and the subline of her own road, the Line Lane. Pityful a rethoric question ran over her cheek, then she continued her way.</p><p>Far far away, behind the word mountains, far from the countries Vokalia and Consonantia, there live the blind texts. Separated they live in Bookmarksgrove right at the coast of the Semantics, a large language ocean.</p><p>A small river named Duden flows by their place and supplies it with the necessary regelialia. It is a paradisematic country, in which roasted parts of sentences fly into your mouth.</p>"
    },
    {
      "id": 20,
      "title": "Your most unhappy customers are your greatest source of learning.",
      "public_date": "",
      "image": "https://res.cloudinary.com/do3hzrufo/image/upload/v1651253082/file-upload/tmp-21-1651253080611_y7w67s.webp",
      "categories": [
        "business"
      ],
      "description": "Far far away, behind the word mountains, far from the countries Vokalia and Consonantia, there live the blind texts.",
      "content": "<p>Far far away, behind the word mountains, far from the countries Vokalia and Consonantia, there live the blind texts. Separated they live in Bookmarksgrove right at the coast of the Semantics, a large language ocean.</p><p>A small river named Duden flows by their place and supplies it with the necessary regelialia. It is a paradisematic country, in which roasted parts of sentences fly into your mouth.</p><blockquote><p><i>The Big Oxmox advised her not to do so, because there were thousands of bad Commas, wild Question Marks and devious Semikoli, but the Little Blind Text didn’t listen. She packed her seven versalia, put her initial into the belt and made herself on the way.</i></p></blockquote><p>Even the all-powerful Pointing has no control about the blind texts it is an almost unorthographic life One day however a small line of blind text by the name of Lorem Ipsum decided to leave for the far World of Grammar.</p><p>When she reached the first hills of the Italic Mountains, she had a last view back on the skyline of her hometown Bookmarksgrove, the headline of Alphabet Village and the subline of her own road, the Line Lane. Pityful a rethoric question ran over her cheek, then she continued her way.</p><p>Far far away, behind the word mountains, far from the countries Vokalia and Consonantia, there live the blind texts. Separated they live in Bookmarksgrove right at the coast of the Semantics, a large language ocean.</p><p>A small river named Duden flows by their place and supplies it with the necessary regelialia. It is a paradisematic country, in which roasted parts of sentences fly into your mouth.</p>"
    },
    {
      "id": 19,
      "title": "Your most unhappy customers are your greatest source of learning.",
      "public_date": "",
      "featured": true,
      "categories": [
        "business",
        "travel"
      ],
      "image": "https://res.cloudinary.com/do3hzrufo/image/upload/v1651253082/file-upload/tmp-21-1651253080611_y7w67s.webp",
      "description": "Far far away, behind the word mountains, far from the countries Vokalia and Consonantia, there live the blind texts. Separated they live in Bookmarksgrove right at the coast of the Semantics, a large language ocean",
      "content": "<p>Far far away, behind the word mountains, far from the countries Vokalia and Consonantia, there live the blind texts.</p><p><img src=\"https://preview.colorlib.com/theme/magdesign/images/ximg_2.jpg.pagespeed.ic.fbbBEgB1Q6.webp\" alt=\"Image\"></p><p>Far far away, behind the word mountains, far from the countries Vokalia and Consonantia, there live the blind texts. Separated they live in Bookmarksgrove right at the coast of the Semantics, a large language ocean.</p><p>A small river named Duden flows by their place and supplies it with the necessary regelialia. It is a paradisematic country, in which roasted parts of sentences fly into your mouth.</p><blockquote><p><i>The Big Oxmox advised her not to do so, because there were thousands of bad Commas, wild Question Marks and devious Semikoli, but the Little Blind Text didn’t listen. She packed her seven versalia, put her initial into the belt and made herself on the way.</i></p></blockquote><p>Even the all-powerful Pointing has no control about the blind texts it is an almost unorthographic life One day however a small line of blind text by the name of Lorem Ipsum decided to leave for the far World of Grammar.</p><p>When she reached the first hills of the Italic Mountains, she had a last view back on the skyline of her hometown Bookmarksgrove, the headline of Alphabet Village and the subline of her own road, the Line Lane. Pityful a rethoric question ran over her cheek, then she continued her way.</p><p>Far far away, behind the word mountains, far from the countries Vokalia and Consonantia, there live the blind texts. Separated they live in Bookmarksgrove right at the coast of the Semantics, a large language ocean.</p><p>A small river named Duden flows by their place and supplies it with the necessary regelialia. It is a paradisematic country, in which roasted parts of sentences fly into your mouth.</p>"
    },
    {
      "id": 19,
      "title": "Your most unhappy customers are your greatest source of learning.",
      "public_date": "",
      "featured": true,
      "categories": [
        "business",
        "travel"
      ],
      "image": "https://res.cloudinary.com/do3hzrufo/image/upload/v1651253082/file-upload/tmp-21-1651253080611_y7w67s.webp",
      "description": "Far far away, behind the word mountains, far from the countries Vokalia and Consonantia, there live the blind texts. Separated they live in Bookmarksgrove right at the coast of the Semantics, a large language ocean",
      "content": "<p>Far far away, behind the word mountains, far from the countries Vokalia and Consonantia, there live the blind texts.</p><p><img src=\"https://preview.colorlib.com/theme/magdesign/images/ximg_2.jpg.pagespeed.ic.fbbBEgB1Q6.webp\" alt=\"Image\"></p><p>Far far away, behind the word mountains, far from the countries Vokalia and Consonantia, there live the blind texts. Separated they live in Bookmarksgrove right at the coast of the Semantics, a large language ocean.</p><p>A small river named Duden flows by their place and supplies it with the necessary regelialia. It is a paradisematic country, in which roasted parts of sentences fly into your mouth.</p><blockquote><p><i>The Big Oxmox advised her not to do so, because there were thousands of bad Commas, wild Question Marks and devious Semikoli, but the Little Blind Text didn’t listen. She packed her seven versalia, put her initial into the belt and made herself on the way.</i></p></blockquote><p>Even the all-powerful Pointing has no control about the blind texts it is an almost unorthographic life One day however a small line of blind text by the name of Lorem Ipsum decided to leave for the far World of Grammar.</p><p>When she reached the first hills of the Italic Mountains, she had a last view back on the skyline of her hometown Bookmarksgrove, the headline of Alphabet Village and the subline of her own road, the Line Lane. Pityful a rethoric question ran over her cheek, then she continued her way.</p><p>Far far away, behind the word mountains, far from the countries Vokalia and Consonantia, there live the blind texts. Separated they live in Bookmarksgrove right at the coast of the Semantics, a large language ocean.</p><p>A small river named Duden flows by their place and supplies it with the necessary regelialia. It is a paradisematic country, in which roasted parts of sentences fly into your mouth.</p>"
    },
    {
      "id": 19,
      "title": "Your most unhappy customers are your greatest source of learning.",
      "public_date": "",
      "featured": true,
      "categories": [
        "business",
        "travel"
      ],
      "image": "https://res.cloudinary.com/do3hzrufo/image/upload/v1651253082/file-upload/tmp-21-1651253080611_y7w67s.webp",
      "description": "Far far away, behind the word mountains, far from the countries Vokalia and Consonantia, there live the blind texts. Separated they live in Bookmarksgrove right at the coast of the Semantics, a large language ocean",
      "content": "<p>Far far away, behind the word mountains, far from the countries Vokalia and Consonantia, there live the blind texts.</p><p><img src=\"https://preview.colorlib.com/theme/magdesign/images/ximg_2.jpg.pagespeed.ic.fbbBEgB1Q6.webp\" alt=\"Image\"></p><p>Far far away, behind the word mountains, far from the countries Vokalia and Consonantia, there live the blind texts. Separated they live in Bookmarksgrove right at the coast of the Semantics, a large language ocean.</p><p>A small river named Duden flows by their place and supplies it with the necessary regelialia. It is a paradisematic country, in which roasted parts of sentences fly into your mouth.</p><blockquote><p><i>The Big Oxmox advised her not to do so, because there were thousands of bad Commas, wild Question Marks and devious Semikoli, but the Little Blind Text didn’t listen. She packed her seven versalia, put her initial into the belt and made herself on the way.</i></p></blockquote><p>Even the all-powerful Pointing has no control about the blind texts it is an almost unorthographic life One day however a small line of blind text by the name of Lorem Ipsum decided to leave for the far World of Grammar.</p><p>When she reached the first hills of the Italic Mountains, she had a last view back on the skyline of her hometown Bookmarksgrove, the headline of Alphabet Village and the subline of her own road, the Line Lane. Pityful a rethoric question ran over her cheek, then she continued her way.</p><p>Far far away, behind the word mountains, far from the countries Vokalia and Consonantia, there live the blind texts. Separated they live in Bookmarksgrove right at the coast of the Semantics, a large language ocean.</p><p>A small river named Duden flows by their place and supplies it with the necessary regelialia. It is a paradisematic country, in which roasted parts of sentences fly into your mouth.</p>"
    },
    {
      "id": 19,
      "title": "Your most unhappy customers are your greatest source of learning.",
      "public_date": "",
      "featured": true,
      "categories": [
        "business",
        "travel"
      ],
      "image": "https://res.cloudinary.com/do3hzrufo/image/upload/v1651253082/file-upload/tmp-21-1651253080611_y7w67s.webp",
      "description": "Far far away, behind the word mountains, far from the countries Vokalia and Consonantia, there live the blind texts. Separated they live in Bookmarksgrove right at the coast of the Semantics, a large language ocean",
      "content": "<p>Far far away, behind the word mountains, far from the countries Vokalia and Consonantia, there live the blind texts.</p><p><img src=\"https://preview.colorlib.com/theme/magdesign/images/ximg_2.jpg.pagespeed.ic.fbbBEgB1Q6.webp\" alt=\"Image\"></p><p>Far far away, behind the word mountains, far from the countries Vokalia and Consonantia, there live the blind texts. Separated they live in Bookmarksgrove right at the coast of the Semantics, a large language ocean.</p><p>A small river named Duden flows by their place and supplies it with the necessary regelialia. It is a paradisematic country, in which roasted parts of sentences fly into your mouth.</p><blockquote><p><i>The Big Oxmox advised her not to do so, because there were thousands of bad Commas, wild Question Marks and devious Semikoli, but the Little Blind Text didn’t listen. She packed her seven versalia, put her initial into the belt and made herself on the way.</i></p></blockquote><p>Even the all-powerful Pointing has no control about the blind texts it is an almost unorthographic life One day however a small line of blind text by the name of Lorem Ipsum decided to leave for the far World of Grammar.</p><p>When she reached the first hills of the Italic Mountains, she had a last view back on the skyline of her hometown Bookmarksgrove, the headline of Alphabet Village and the subline of her own road, the Line Lane. Pityful a rethoric question ran over her cheek, then she continued her way.</p><p>Far far away, behind the word mountains, far from the countries Vokalia and Consonantia, there live the blind texts. Separated they live in Bookmarksgrove right at the coast of the Semantics, a large language ocean.</p><p>A small river named Duden flows by their place and supplies it with the necessary regelialia. It is a paradisematic country, in which roasted parts of sentences fly into your mouth.</p>"
    },
    {
      "id": 21,
      "title": "The Worst Bug Ever—Randomly Losing Your Best Players",
      "public_date": "",
      "image": "https://res.cloudinary.com/do3hzrufo/image/upload/v1651262309/file-upload/tmp-22-1651262307205_uck0su.jpg",
      "description": "Imagine discovering a serious bug in production immediately after releasing your game. Imagine this bug hurts only your paying customers. Imagine it freezes the game immediately after players complete an in-app purchase. Imagine that when the player restarts, the game freezes during start-up. Imagine the player can never get unstuck and has to uninstall the game. Imagine your app",
      "content": "<p style=\"margin-left:0px;\">Imagine discovering a serious bug in production immediately after releasing your game. Imagine this bug hurts only your paying customers. Imagine it freezes the game immediately after players complete an in-app purchase. Imagine that when the player restarts, the game freezes during start-up. Imagine the player can never get unstuck and has to uninstall the game. Imagine your app is currently featured on the Apple Store. This is a story of such a bug, the worst bug I have ever dealt with in 30 years of programming. This is a story of how we tracked it down and worked with Unity to fix it.</p><h2 style=\"margin-left:0px;\"><strong>Red Alert</strong></h2><p style=\"margin-left:0px;\">In the 24 hours after going live with <a href=\"https://apps.apple.com/us/story/id1601333351\"><u>Adventure Chef: Merge Explorer</u></a> for iOS, we started seeing a large number of our players encountering freezes during start-up of our game. We use <a href=\"https://www.bugsnag.com/\"><u>Bugsnag’s</u></a> excellent app stability monitoring library and dashboard. There was a set of callstacks pointing to <a href=\"https://docs.unity3d.com/Packages/com.unity.purchasing@4.1/manual/index.html\"><u>Unity’s In App Purchasing</u></a> (IAP) package. Apparently, this popular Unity library was causing our app to be unresponsive for over two seconds, which triggered the operating system to force quit our app. It appeared that this Unity code was simply parsing an iOS receipt, a bit of text in memory, to determine what the player had bought.</p><p style=\"margin-left:0px;\">What could be causing Unity IAP 4.1.1 to take more than two seconds just to parse a chunk of text in memory?</p><p style=\"margin-left:0px;\">There was an extreme sense of urgency. I won’t call it a panic, but urgent messages were being sent on Slack. My manager texted my phone for the first time in six years:</p><p style=\"margin-left:auto;\"><img class=\"image_resized\" style=\"width:481px;\" src=\"https://miro.medium.com/max/481/0*liobxep6D6xQ3FJr\" alt=\"\"></p><p style=\"margin-left:0px;\">As the engineer most responsible for our low-level IAP support within the game, I was most knowledgeable about what was going on and I felt the weight of this responsibility. I won’t call it a panic, but yeah, this was stressful for sure.</p><p style=\"margin-left:0px;\">At first, I just tried to get a handle on what was happening. Initially, we thought it was affecting 10% of our iOS players. After more careful examination, we realized it was about 1.4%. So many callstacks (what the program was doing at the time of the error) were different. Many of them indicated that memory was being allocated. Was there some kind of C# memory problem?</p><p style=\"margin-left:auto;\">&nbsp;</p><p style=\"margin-left:0px;\">But all of these callstacks were within Unity IAP’s code that seemed to be parsing Apple receipts, based on the method names. So, my theory was that we were seeing an infinite loop where some kind of tree structure was being parsed but wasn’t finishing, and the wide variety of callstacks just happened to show where the operating system killed our app. I gathered relevant information and filed the highest priority bug report possible with Unity.</p><h2 style=\"margin-left:0px;\"><strong>The Workaround — Reverting to a Better Bug</strong></h2><p style=\"margin-left:0px;\">After talking with teammates, someone pointed out that this bug didn’t occur in the previous beta release of our game which used Unity IAP 3.2.3. Well, the reason we upgraded was to improve a “No Products Available” error where the player would be randomly prevented from doing in-app purchases on Android, but they could at least restart the game and likely succeed. But this “iOS app hang” bug was unimaginably worse, so it was an easy decision to revert to an earlier version of Unity IAP. So, at that point we at least had a work-around. We reverted from Unity IAP 4.1.1 to 3.2.3 and did overnight offshore testing and then submitted the fixed version to Apple.</p><p style=\"margin-left:0px;\">Since Pocket Gems has a contract with Unity, we get first-rate customer service. Customer support got back to us within an hour and the IAP team was alerted shortly after that. Then, they said they could reproduce a freeze as well. Wow, that was fast!</p><p style=\"margin-left:0px;\">With the crisis temporarily resolved and with the Unity IAP team working on the problem and possibly having a fix already, I was able to finish other urgent tasks as we headed into our winter break.</p><h2 style=\"margin-left:0px;\"><strong>ASN.1 and the Deep Dive</strong></h2><p style=\"margin-left:0px;\">I was still troubled that we didn’t know how to reproduce this freeze. The Unity IAP team said they could reproduce a freeze, but was it the same freeze? How would I verify their upcoming fix? We could be stuck on IAP 3.2.3 forever.</p><p style=\"margin-left:0px;\">Going into our winter break, I had time on my hands due to the pandemic and not wanting to travel. I was really curious about whether I could reproduce this problem. I tried to understand what the Unity IAP code was doing. It looked like it was building a tree structure from the Apple receipt, which is a text string that is base-64 encoded, representing a cross-platform binary structure in the ASN.1 format.</p><p style=\"margin-left:0px;\">ASN.1 is a hierarchical structure of container-like elements and leaf-nodes of simple attributes:</p><p style=\"margin-left:auto;\"><img class=\"image_resized\" style=\"width:692px;\" src=\"https://miro.medium.com/max/700/0*fOc_A22X4MfM_gM4\" alt=\"\"></p><p style=\"margin-left:0px;\">Crucially, if you don’t have a schema or some external description of the data layout, then a blob of bytes, like in the OCTET STRING above, might either be a child ASN.1 structure or it might just be a leaf node containing some string. The parent structure can’t tell you one way or another! So, to decode an arbitrary ASN.1 object, you just have to try to parse every element and see what happens. From an architecture and safety point of view, trying to decode a random binary blob to see if it happens to be a well-defined structure is risky and reminds me of <a href=\"https://xkcd.com/327/\"><u>Little Bobby Tables</u></a>.</p><p style=\"margin-left:auto;\"><img class=\"image_resized\" style=\"width:666px;\" src=\"https://miro.medium.com/max/666/0*epxybYPRG4y5ADxK\" alt=\"\"></p><p>Image: <a href=\"https://xkcd.com/327/\"><u>XKCD</u></a></p><p style=\"margin-left:0px;\">Is this how Unity IAP was getting into trouble, by trying to parse random bytes? Spoiler alert: yes, yes it was.</p><h2 style=\"margin-left:0px;\"><strong>Reproduction</strong></h2><p style=\"margin-left:0px;\">I decided to build an automated unit test that could run just the Apple receipt parsing code within the Unity IAP package, without all of the overhead of debugging our game on an iOS device. Unfortunately, their code is not included when building for Unity Editor’s Player, but I was able to copy the C# files out of this directory, in the root of my local Unity project directory: /Library/PackageCache/com.unity.purchasing@4.1.1/Runtime/Security/Asn1Processor/</p><p style=\"margin-left:0px;\">For data, we save our players’ anonymized receipts to a Google BigQuery table, so I ran a query looking at a small subset of receipts from in-app purchases by our actual iOS players. I downloaded the data as a CSV file and wrote a quick bit of parsing code. I had just over 300 real-world receipts.</p><p style=\"margin-left:0px;\">Could I reproduce the freeze? I attached my C# debugger (in the excellent Rider IDE from JetBrains) to Unity Editor, and ran my new unit test. I stepped across the call to Unity’s ASN1 receipt parsing code. The next line of code wasn’t reached. The unit test was running. Frozen. The very first receipt reproduced the freeze! Restarted. Skipped the first receipt. The second receipt parsed fine. And the third and fourth. I let the unit test run freely. Another freeze.</p><p style=\"margin-left:0px;\">I copied the same code files from Unity IAP 3.2.3 to double-check that it would parse these 300 receipts. Yes, no problem.</p><p style=\"margin-left:0px;\">I was so happy! I could reproduce the problem! Now for more receipts!</p><p style=\"margin-left:0px;\">I faced an interesting problem with my automated test — how do I test thousands of receipts knowing that some of them are going to cause an infinite loop yet I want my test to finish and output the results?</p><p style=\"margin-left:0px;\">One way was to assign a Task to each receipt and then use the .NET WaitAll method along with a timeout parameter. Tasks are run on background threads in the .NET threadpool, and so your main thread wouldn’t be blocked and could report the results.</p><p style=\"margin-left:auto;\">&nbsp;</p><p style=\"margin-left:0px;\">Out of 9,163 receipts, 2 caused a crash, 180 caused a freeze, and 8,981 parsed correctly. Error rate: 2.0% (= 182 / 9163).</p><h2 style=\"margin-left:0px;\"><strong>Better Workaround</strong></h2><p style=\"margin-left:0px;\">While waiting for a fix from Unity, we realized we needed to use one version of Unity IAP for Android and a different version for iOS. We were navigating around two bugs!</p><ul><li>Unity IAP 3.2.3 — use this for iOS. It has the “No Products Available” bug which almost exclusively affects Android but, crucially, it does not have the “iOS app hang” bug.</li><li>Unity IAP 4.1.1 — use this for Android. It improves the “No Products Available” error for Android but it introduced the “iOS app hang” bug (which only affects iOS, not Android).</li></ul><p style=\"margin-left:0px;\">But how do you select the package version based on platform? My coworker knew of an elegant solution — you can select it programmatically when loading the project in Unity Editor! The default in the Package Manager would be Unity IAP 3.2.3, and our builder would choose Unity IAP 4.1.1 for Android.</p><p style=\"margin-left:auto;\">&nbsp;</p><h2 style=\"margin-left:0px;\"><strong>Back-and-Forth For the Fix</strong></h2><p style=\"margin-left:0px;\">I asked the Unity IAP team for a preview of their fix, to double-check that it passed my automated test. They agreed, but when I tried out their fix it did not fix the freeze, unfortunately.</p><p style=\"margin-left:0px;\">It was hard for me to be sure that my way of reproducing the freeze was valid. What if I was misusing their code? I was sensing confusion in our back-and-forth on the support ticket. So, on a Thursday afternoon, I asked for a meeting with their programmers. They agreed and set up a meeting for 10 a.m. the next morning. Wow, talk about customer support!</p><p style=\"margin-left:0px;\">They explained what they thought was going on with the freeze — that it was being caused by Unity IAP 4.x having improved support of the fake store in Unity Editor’s Player, by doing a deeper parsing of these ASN.1 structures. They confirmed that my automated test was valid.</p><h2 style=\"margin-left:0px;\"><strong>The Root Cause</strong></h2><p style=\"margin-left:0px;\">What does that mean, to do a “deeper parsing?” Imagine you’re seeing this octet string in your ASN.1 object:</p><p style=\"margin-left:0px;\">5285A91861B12FC85E94CF4C6E521B094…</p><p style=\"margin-left:0px;\">The ASN.1 structure doesn’t say how this octet string should be interpreted; it’s just a text representation of some binary data. By convention, some octet strings in an Apple receipt represent a standalone ASN.1 encoded object. Which ones? Well, Apple <a href=\"https://developer.apple.com/library/archive/releasenotes/General/ValidateAppStoreReceipt/Chapters/ReceiptFields.html#//apple_ref/doc/uid/TP40010573-CH106-SW1\"><u>defines</u></a> that, but I guess that’s kind of a pain to figure out and it’s just easier to try to decode and see what happens! YOLO!</p><p style=\"margin-left:0px;\">The ASN.1 format has <a href=\"https://www.obj-sys.com/asn1tutorial/node124.html\"><u>short tags</u></a> that indicate the type of the structure. For example, 0x3 identifies a bit string, and 0x4 identifies an octet string. There are tags for containers like sets (0x11) and sequences (0x10), etc. So, it’s not hard to have a random byte be misidentified as a tag.</p><p style=\"margin-left:0px;\">The Unity IAP team found themselves having to harden their code against random data that might as well be from an untrusted adversarial source, just like in the above Little Bobby Tables cartoon. It’s a hard problem to correctly parse complex structures that are incorrectly formatted. This is what led to unhandled exceptions and infinite loops.</p><p style=\"margin-left:0px;\">Anyway, I soon got a second preview of their fix. It fixed the freeze! But, it crashed on a different receipt. I gave them that receipt, too.</p><p style=\"margin-left:0px;\">3rd attempt — looks good! All 9,163 receipts were cleanly parsed!</p><p style=\"margin-left:0px;\">Soon, Unity IAP 4.1.3 was released with the fixes. Whew! I could then get rid of our hacky work-around.</p><h2 style=\"margin-left:0px;\"><strong>The Release</strong></h2><p style=\"margin-left:0px;\">I was relieved that our offshore testing and automated testing looked clean with Unity’s IAP 4.1.3 release. We released a new version of Adventure Chef using this fix, and everything looked good.</p><p style=\"margin-left:0px;\">I was happy to have helped other Unity-based game developers who may have not even known that some of their customers had run into this issue. And I was happy to help our partner, Unity, too.</p><p style=\"margin-left:0px;\">Here is the summary in the Unity IAP 4.1.3 <a href=\"https://docs.unity3d.com/Packages/com.unity.purchasing@4.1/changelog/CHANGELOG.html\"><u>changelog</u></a>; a lot of work and stress were behind this innocent-sounding sentence!</p><blockquote><p style=\"margin-left:0px;\"><i>“Fixed edge case where Apple StoreKit receipt parsing would fail, preventing validation.”</i></p></blockquote>",
      "categories": []
    }
  ],
  "categories": [
    "business",
    "edutcation",
    "life style",
    "work",
    "study",
    "event",
    "workout"
  ]
}